# 完整專案目錄結構

```
trading_system/                    # 專案根目錄
│
├── main.py                        # 主程式入口 (在這裡執行)
│
├── opds.ini                       # ⭐ 設定檔 (放根目錄)
├── Sinopac.pfx                    # ⭐ CA 憑證檔案 (放根目錄)
├── margin_data.json               # ⭐ 保證金資料 (放根目錄)
│
├── config/                        # 設定管理模組
│   ├── __init__.py
│   └── config_loader.py
│
├── backend/                       # 後端邏輯模組
│   ├── __init__.py
│   ├── core.py                    # 核心類別
│   ├── auth.py                    # 認證管理
│   ├── positions.py               # 倉位管理
│   ├── orders.py                  # 訂單管理
│   ├── futures_management.py      # 期貨管理
│   ├── options_management.py      # 選擇權管理
│   ├── subscription.py            # 訂閱報價
│   └── contract_utils.py          # 合約工具
│
├── gui/                           # GUI 模組
│   ├── __init__.py
│   ├── main_window.py             # 主視窗
│   ├── positions_table.py         # 倉位表格
│   ├── event_handlers.py          # 事件處理
│   └── dialogs/                   # 對話框子模組
│       ├── __init__.py
│       ├── futures_roll_dialog.py
│       ├── options_change_dialog.py
│       ├── new_position_dialog.py
│       └── monitor_window.py
│
├── utils/                         # 工具模組
│   ├── __init__.py
│   ├── margin_fetcher.py          # 保證金計算
│   └── helpers.py                 # 輔助函數
│
├── logs/                          # 日誌目錄 (可選)
│   └── trading.log
│
├── .gitignore                     # Git 忽略檔案
├── requirements.txt               # Python 套件需求
└── README.md                      # 專案說明
```

---

## 為什麼設定檔要放根目錄?

### 1. **程式執行位置**
```bash
# 你會在根目錄執行:
cd trading_system
python main.py

# 所以相對路徑 'opds.ini' 就是指根目錄的 opds.ini
```

### 2. **程式碼中的路徑**
```python
# main.py 或任何模組中
config_file = 'opds.ini'  # 相對於執行目錄 (根目錄)
ca_path = 'Sinopac.pfx'   # 相對於執行目錄 (根目錄)
```

### 3. **方便管理**
- 設定檔在根目錄,容易找到和編輯
- 不需要在程式碼中處理複雜的路徑

---

## opds.ini 範例

```ini
[user_pw]
API_KEY = your_api_key_here
SECRET_KEY = your_secret_key_here
ca_path = Sinopac.pfx
ca_passwd = your_ca_password
person_id = A123456789
```

---

## .gitignore 重要!

⚠️ **注意**: 這些檔案包含敏感資訊,**不應該上傳到 Git**!

建立 `.gitignore` 檔案在根目錄:

```gitignore
# 敏感設定檔
opds.ini
*.pfx
*.p12

# 資料檔
margin_data.json

# Python 相關
__pycache__/
*.py[cod]
*$py.class
*.so
.Python
venv/
env/

# IDE
.vscode/
.idea/
*.swp

# 日誌
logs/
*.log
```

---

## 如果 CA 憑證在其他位置?

如果你的 CA 憑證不在根目錄,可以在 `opds.ini` 中使用絕對路徑:

```ini
[user_pw]
API_KEY = your_api_key_here
SECRET_KEY = your_secret_key_here
ca_path = C:\Users\YourName\Documents\Sinopac.pfx    # Windows 絕對路徑
# 或
ca_path = /home/username/certs/Sinopac.pfx           # Linux 絕對路徑
ca_passwd = your_ca_password
person_id = A123456789
```

---

## 改進 config_loader.py (支援多種路徑)

```python
# config/config_loader.py
import os

def load_credentials(config_file='opds.ini'):
    """支援相對路徑和絕對路徑"""
    
    # 如果是相對路徑,從專案根目錄尋找
    if not os.path.isabs(config_file):
        # 取得專案根目錄 (main.py 所在位置)
        project_root = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))
        config_file = os.path.join(project_root, config_file)
    
    if not os.path.exists(config_file):
        print(f"警告: 找不到設定檔 {config_file}")
        return {}
    
    # ... 其餘載入邏輯
```

---

## 快速建立專案結構腳本

```python
# create_structure.py (放在根目錄執行)
import os

# 建立目錄結構
folders = [
    'config',
    'backend', 
    'gui',
    'gui/dialogs',
    'utils',
    'logs'
]

for folder in folders:
    os.makedirs(folder, exist_ok=True)
    init_file = os.path.join(folder, '__init__.py')
    if not os.path.exists(init_file):
        with open(init_file, 'w', encoding='utf-8') as f:
            f.write(f'# {folder} module\n')
    print(f"✓ {folder}/__init__.py")

# 建立 .gitignore
gitignore_content = """# 敏感設定檔
opds.ini
*.pfx
*.p12

# 資料檔
margin_data.json

# Python
__pycache__/
*.py[cod]
venv/
"""

with open('.gitignore', 'w', encoding='utf-8') as f:
    f.write(gitignore_content)
print("✓ .gitignore")

# 建立 requirements.txt
requirements = """shioaji
tkinter
configparser
"""

with open('requirements.txt', 'w', encoding='utf-8') as f:
    f.write(requirements)
print("✓ requirements.txt")

print("\n✅ 專案結構建立完成!")
print("請將 opds.ini 和 CA 憑證檔案放在專案根目錄")
```

執行:
```bash
python create_structure.py
```

---

## 總結

✅ **放根目錄的檔案**:
- `opds.ini` (設定檔)
- `Sinopac.pfx` (CA 憑證)
- `margin_data.json` (保證金資料)
- `.gitignore` (Git 忽略清單)

✅ **執行方式**:
```bash
cd trading_system    # 進入根目錄
python main.py       # 執行主程式
```

✅ **安全建議**:
- 使用 `.gitignore` 避免上傳敏感檔案
- 不要分享包含真實 API Key 的設定檔